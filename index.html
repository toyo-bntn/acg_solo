<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ACG ソロ </title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="overlay" id="overlay">
  <div class="panel">
    <h2 style="margin:0;">
      デッキを読み込んで開始
    </h2>
          <div class="twoCol">
        <div>
          <button class="btn" id="pickDeckBtn">デッキJSONを選ぶ</button>
          <span id="deckChosen" class="chip hidden"></span>
        </div>
        <div class="hint">※<button class="btn sm" id="loadDefaultDeckBtn">お試し（deck_list_kimesai.json 読込）</button></div>
      </div>
    <div class="hint">
      <ul style="margin:0px 0 0 9px">
      <li>ACGの一人回し用の非公式サイトです．</li>
      <li>ACGビルダーで保存したJSONを選択してください。</li>
      <li>（<code>deck_list.json :</code> <code>mainDeck</code> / <code>territoryDeck</code>/ <code>reserveDeck</code>）</li>
      <li>デッキ枚数：<code>基礎デッキ: 40枚以上</code>, <code>領土デッキ: 10枚</code>, <code>サイドデッキ: 15枚以下</code></li>
      <li>カード画像をまとめたフォルダをローカルで作成し，読み込ませてください． <code>./images/&lt;カードナンバー&gt;.*</code>.（裏面：<code>./images/Back.*</code>，トークン：<code>./images/token.*</code>）</li>
    </div>
    <div class="rows">
      <div class="twoCol">
        <div>
          <span class="hint">カード情報 (<code>card_list.json</code>) を自動読込します。失敗時は手動指定：</span>
          <button class="btn sm" id="pickCardListBtn">card_list.json を選ぶ</button>
          <span id="cardListChosen" class="chip hidden"></span>
        </div>
        <div class="hint" id="cardListStatus">未読込</div>
      <div class="hint" style="align-items:center; gap:8px;">
        <span>カード画像のフォルダ（images）を選択してください</span>
        <input type="file" id="imagesDirInput" class="hidden" webkitdirectory directory multiple>
        <button class="btn sm" id="btnPickImages">選択</button>
        <span id="imagesStatus" class="hint bad hidden">カード画像がありません</span>
      </div>
      </div>

      <div style="display:flex; gap:8px; justify-content:flex-end">
        <button class="btn btn-lg primary" id="startBtn" disabled>読み込んで開始</button>
      </div>
    </div>
  </div>
</div>

<div class="wrap">
  <header>
    <div class="left">
      <strong>ACG ソロ</strong>
      <span class="chip">seed: <span id="seedView">-</span></span>
      <button class="btn" id="btnReloadDeck">デッキ選択</button>   
      <button class="btn" id="btnInit7">初手</button>
      <button class="btn" id="btnReset">!!盤面リセット!!</button>
      <button class="btn" id="btnSide">サイド表示</button> 
      <span id="initReturn" class="pill bad hidden">マリガン（残: <span id="initReturnLeft">2</span>）</span>
    </div>
    <div class="right">
      <button class="btn" id="btnExport">盤面保存</button>
      <button class="btn" id="btnImport">盤面読込</button>
      <button class="btn" id="btnReplay"></button>
      <button class="btn" id="btnShot">盤面スクショ</button>

      <span class="chip" id="deckCountChip">基礎デッキ: 0</span> 
      <span class="chip" id="tDeckCountChip">領土デッキ: 0</span> 
      <button class="chip" id="btnDraw" style="border:1px solid #fafafa"></button> 
      <button class="chip" id="btnDraw1">1ドロー (D)</button>
    </div>
</header>

<!-- === サイドデッキ オーバーレイ === -->
<div id="sidePanel" class="Panel hidden sidePanel">
    <section class="zone" data-zone="SIDEDECK">
      <h3 id="sideDeckTitle" style="display: flex; justify-content: space-between; align-items:center">サイドデッキ：0 
      <span class="toolbar" style="margin-left: auto">
        <label class="chip"><input id="sortSide" type="checkbox"> 名前順</label>
      </span>
      </h3>
      <div class="content" id="sideDeck" data-zone="SIDEDECK"
           ondragover="onDragOver(event)" ondrop="onDrop(event)">
      </div>
    </section>
 <div class="row" style="display: flex; justify-content:space-between;align-items:center">
    <div class="hint">※ 基礎デッキ←→サイドは同じ枚数のみ可能</div>
    <button class="btn sm" id="btnSideClose" style="margin-left: auto">閉じる</button>
    <button class="btn sm" id="resetSideDeck">デッキリセット</button>
 </div>
</div>

  <!-- 左：フリーゾーン + プレビュー + ログ -->
  <div class="leftpane">
  <section class="zone" id="zone-log">
    <h3>操作ログ 
    <span class="toolbar">
      <button class="btn sm" id="btnUndo" disabled>戻る</button>
      <button class="btn sm" id="btnRedo" disabled>進む</button>
      <button class="btn" id="btnRecToggle" data-state="stopped">●REC</button>
    </span>
    </h3>
    <div class="history-bar">
      <!-- スライダー本体 -->
      <input
        type="range"
        id="historySlider"
        min="0"
        max="0"
        value="0"
        step="1">
        <!-- カウントと倍速 -->
        <div class="row" style="justify-content:space-between;align-items:center">
          <div class="hint" id="replayStatus">0/0</div>
          <div class="rateGroup">
            <button class="btn sm rate" data-rate="1">x1</button>
            <button class="btn sm rate" data-rate="2">x2</button>
            <button class="btn sm" id="btnPlayToggle" data-state="stopped" aria-label="再生">再生▷</button>
          </div>
        </div>
    </div>
      <!-- ログ: <div class="log" id="logBox"></div>-->
  </section>
  
  <section class="zone" id="zone-free">
    <h3>FREE
      <button class="btn sm" id="btnToken">ﾄｰｸﾝ</button>
      <span class="toolbar">
        <span class="counterPalette" id="counterPalette">
          <span class="paletteItem" draggable="true" data-ctype="p1p1">+1/+1</span>
          <span class="paletteItem" draggable="true" data-ctype="plus1">[+1]</span>
          <span class="paletteItem" draggable="true" data-ctype="effect_on">[効果]</span>
        </span>
      </span>
    </h3>
    <div class="content" data-zone="FREE" ondragover="onDragOver(event)" ondrop="onDrop(event)"></div>
  </section>

  <section class="zone" id="zone-preview">
    <h3>拡大プレビュー＆情報</h3>
    <div class="preview">
      <div class="big"><img id="bigImg" alt=""></div>
      <div class="info" id="infoBox">
        <h4 id="infoTitle">（カード未選択）</h4>
        <div class="kv" id="infoKV"></div>
        <div class="sep" style="height:1px;background:#273044;margin:3px 0"></div>
        <div id="infoText"></div>
      </div>
    </div>
  </section>
  </div>

  <!-- 中央：4行 -->
  <main>
    <section class="zone" data-zone="BATTLEFIELD">
      <h3>戦場</h3>
      <div class="content" id="battlefield" ondragover="onDragOver(event)" ondrop="onDrop(event)"></div>
    </section>

    <section class="zone" data-zone="HAND">
      <h3>手札 <span class="toolbar">
        <label class="chip"><input id="sortHand" type="checkbox"> 名前順</label>
      </span></h3>
      <div class="content" id="hand" ondragover="onDragOver(event)" ondrop="onDrop(event)"></div>
    </section>

    <section class="zone" data-zone="DECK">
      <h3>基礎デッキ 
        <span class="toolbar" style="margin-left:auto">
          <span class="leftTools">
            <span class="hint">※ﾀﾞﾌﾞﾙｸﾘｯｸ：先頭(右端)→手札</span>
          </span>
          <span class="rightInfo">
            <button class="btn sm" id="btnDrawFromDeck">手札補充+1</button>
            <button class="btn sm" id="btnDealToFree">FREE+1</button>
            <button class="btn sm" id="btnShuffleMain">基デ🔀</button>
          </span>
      <span class="toolbar" style="margin-left: auto">
        <label class="chip"><input id="sortDeck" type="checkbox"> 名前順</label>
      </span>
        </span>
      </h3>
      <div class="content" id="mainDeck" ondblclick="drawFromMain()" ondragover="onDragOver(event)" ondrop="onDrop(event)"></div>
    </section>
    <section class="zone">
      <h3>領地/領土デッキ <span class="toolbar">
        <span class="hint">※ﾀﾞﾌﾞﾙｸﾘｯｸ：先頭(右端)→領地</span>
        <button class="btn sm" id="btnDrawFromTDeck">領地補充+1</button>
        <button class="btn sm" id="btnShuffleTerr">領デ🔀</button>
      </span></h3>
      <div class="row content" style="border:none">
        <div class="zone" data-zone="T_DECK">
          <h3>領土デッキ</h3>
          <div class="content" id="tDeck" ondblclick="drawFromTDeck()" ondragover="onDragOver(event)" ondrop="onDrop(event)"></div>
        </div>
        <div class="zone" style="flex:1" data-zone="T_FIELD">
          <h3>領地<span class="toolbar">
          <button class="btn sm" id="btnWakeTerritory" style="margin-right:auto">起床</button>
          <label class="chip"><input id="sortTerritory" type="checkbox">領土 名前順</label>
          </span>
          </h3>
          <div class="content" id="territory" ondragover="onDragOver(event)" ondrop="onDrop(event)"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- 右：墓地/除外 -->
  <aside>
    <section class="zone" data-zone="GRAVE">
      <h3>墓地</h3>
      <div class="content" id="grave" ondragover="onDragOver(event)" ondrop="onDrop(event)"></div>
    </section>
    <section class="zone" data-zone="BANISH">
      <h3>除外</h3>
      <div class="content" id="banish" ondragover="onDragOver(event)" ondrop="onDrop(event)"></div>
    </section>
  </aside>

  <footer>
    <div class="hint">右クリック：表裏 / ダブルクリック：回転（戦・領のみ） / ショートカット：<b>D</b>=ドロー, <b>R</b>=回転, <b>X</b>=表裏, <b>F</b>=基デ→FREE, <b>S</b>=ログ保存</div>
  </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script type="module" src="script.js"></script>
</body>
</html>

<!--https://toyo-bntn.github.io/acg_solo/-->